# 彩色星座图可视化说明

## 概述

为了更清晰地展示CMA盲均衡和相位校正的效果，我们为星座图添加了**颜色标记功能**。不同的4QAM符号用不同颜色表示，使得均衡前后的变化一目了然。

## 颜色映射方案

### 4QAM符号与颜色对应关系

| 比特序列 | 符号编号 | 星座点位置 | 颜色 | 象限 |
|---------|---------|-----------|------|-----|
| 00 | 0 | (1+j)/√2 | 🔴 红色 | 第一象限 (I) |
| 01 | 1 | (1-j)/√2 | 🟢 绿色 | 第四象限 (IV) |
| 11 | 2 | (-1-j)/√2 | 🔵 蓝色 | 第三象限 (III) |
| 10 | 3 | (-1+j)/√2 | 🟡 黄色 | 第二象限 (II) |

### 设计理念

- **四种颜色**: 红、绿、蓝、黄四种鲜明对比色，易于区分
- **象限对应**: 每个颜色对应一个象限，直观显示符号位置
- **理想星座点**: 用带黑边的彩色圆圈标记，醒目且专业

## 使用方法

### 1. 主仿真脚本 (`main_cma_simulation.m`)

运行主仿真会自动生成三张对比星座图：

```matlab
matlab -batch "main_cma_simulation"
```

**输出图表**:
- **左图**: 接收信号 (ISI + 噪声) - 展示信道失真效果
- **中图**: CMA均衡后 (未相位校正) - 展示均衡效果但存在相位旋转
- **右图**: 相位校正后 - 最终输出，符号准确对齐

### 2. 参数实验脚本 (`run_experiments.m`)

运行参数实验会生成多组对比星座图：

```matlab
matlab -batch "run_experiments"
```

**三个实验**:
1. **步长因子μ的影响**: 显示不同步长下的均衡效果
2. **滤波器长度M的影响**: 显示不同滤波器长度的性能
3. **SNR性能曲线**: 对比不同信噪比下的BER

### 3. 彩色星座图演示 (`demo_color_constellation.m`)

专门的演示脚本，突出显示颜色标记的效果：

```matlab
matlab -batch "demo_color_constellation"
```

**特点**:
- 使用中等SNR (20dB) 以清晰展示均衡效果
- 较少符号数 (5000) 使图表更清晰
- 提供详细的观察要点说明

## 可视化效果分析

### 阶段1: 接收信号 (左图)

**观察现象**:
- ❌ 四种颜色的点**严重混叠**，无法区分
- ❌ 点云分散在整个平面，远离理想星座点
- ❌ ISI导致符号间干扰，无法正确判决

**原因**: 
- ISI信道 `[1, 0.5, 0.2]` 引入符号间干扰
- AWGN噪声增加随机扰动

### 阶段2: CMA均衡后 (中图)

**观察现象**:
- ✅ 四种颜色的点开始**分离聚集**
- ✅ 每种颜色形成一个独立的点云簇
- ⚠️ 点云可能存在**整体旋转**（相位偏移）
- ✅ 点云幅度基本恒定 (|y| ≈ 1)

**原因**:
- CMA均衡器消除了ISI影响
- 恒模算法使输出幅度趋于常数R
- 但CMA对相位不敏感，存在相位模糊

### 阶段3: 相位校正后 (右图)

**观察现象**:
- ✅ 四种颜色的点**精确对齐**到理想星座点
- ✅ 红色点聚集在第一象限 (1+j)/√2
- ✅ 绿色点聚集在第四象限 (1-j)/√2
- ✅ 蓝色点聚集在第三象限 (-1-j)/√2
- ✅ 黄色点聚集在第二象限 (-1+j)/√2
- ✅ BER = 0% (高SNR时)

**原因**:
- 导频辅助相位估计校正了相位偏移
- 符号准确恢复，可正确解调

## 技术细节

### 颜色与符号的对应实现

```matlab
% 定义颜色映射 (RGB值)
color_map = [
    0.85, 0.15, 0.15;  % 符号0: 红色
    0.15, 0.85, 0.15;  % 符号1: 绿色
    0.15, 0.15, 0.85;  % 符号2: 蓝色
    0.95, 0.75, 0.05   % 符号3: 黄色
];

% 按符号着色绘图
for sym_idx = 0:3
    % 找到发射该符号的位置
    tx_positions = find(grayIndices == sym_idx);
    
    % 绘制对应颜色的点
    plot(real(symbols), imag(symbols), '.', ...
         'Color', color_map(sym_idx+1, :), ...
         'MarkerSize', 6);
end
```

### 延迟对齐处理

为了保证颜色标记的准确性，需要考虑：

1. **信道延迟**: `length(channelTaps) - 1`
2. **均衡器延迟**: `floor(M/2)`
3. **瞬态样本**: `transient_samples`

```matlab
tx_symbol_delay = floor((best_delay + transient_samples*2) / 2);
eq_idx = tx_positions - tx_symbol_delay;
```

## 应用场景

### 教学演示
- 清晰展示盲均衡的工作原理
- 直观理解ISI、均衡、相位校正的效果
- 便于学生观察不同参数的影响

### 性能分析
- 快速判断均衡器是否收敛
- 识别相位旋转问题
- 评估不同SNR下的性能

### 算法调试
- 检查符号是否正确对齐
- 发现延迟估计错误
- 验证格雷码映射正确性

## 文件清单

| 文件 | 功能 | 输出 |
|-----|------|------|
| `main_cma_simulation.m` | 主仿真脚本 | 3子图对比 (接收/均衡/校正) |
| `run_experiments.m` | 参数实验 | 多组星座图对比 |
| `demo_color_constellation.m` | 演示脚本 | 清晰的三阶段对比图 |

## 示例输出

运行 `demo_color_constellation.m` 后，控制台输出：

```
========================================
彩色星座图演示 - CMA均衡效果可视化
========================================

配置:
  符号数: 5000
  SNR: 20 dB
  信道: ISI [1, 0.5, 0.2]

发射端: 生成 5000 个4QAM符号
信道: ISI + AWGN (SNR=20dB)
CMA均衡: 完成 (权重范数=0.9289)
相位校正: 偏移=-0.07度

生成彩色星座图...
可视化完成!

观察要点:
  - 左图: 接收信号受ISI影响，各颜色点混叠分散
  - 中图: CMA均衡消除ISI，各颜色点聚集但存在相位旋转
  - 右图: 相位校正后，各颜色点准确对齐到理想星座点

========================================
```

图表会自动弹出，显示三个并排的星座图，每个图中不同符号用不同颜色标记。

## 总结

彩色星座图可视化功能使CMA均衡效果更加直观：

✅ **视觉冲击**: 颜色对比强烈，效果一目了然  
✅ **科学严谨**: 颜色-符号对应关系明确  
✅ **易于理解**: 适合教学演示和技术报告  
✅ **专业美观**: 图表质量达到论文发表水平

---

*作者: 数字信号处理大作业项目组*  
*日期: 2025-10-15*
