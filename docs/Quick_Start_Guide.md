# MATLAB CMA均衡器 - 快速使用指南

## 目录

1. [环境准备](#环境准备)
2. [验证安装](#验证安装)
3. [运行仿真](#运行仿真)
4. [理解输出结果](#理解输出结果)
5. [自定义参数](#自定义参数)
6. [常见问题](#常见问题)

## 环境准备

### 系统要求
- MATLAB R2018b 或更高版本
- 无需额外工具箱(所有函数从零实现)
- 推荐: 至少4GB RAM

### 文件准备
确保您在正确的目录:
```matlab
% 在MATLAB命令窗口中
cd('e:\Project\Digital_Signal_Processing_Giant_Design\matlab_project\core')
```

## 验证安装

### 步骤1: 验证FFT/IFFT

运行FFT验证脚本:
```matlab
run('test_fft.m')
```

**预期输出**:
```
========================================
FFT和IFFT验证测试
========================================

--- 测试长度 N = 64 ---
  测试1: 单位冲激... 通过 (误差: 1.23e-14)
  测试2: 直流信号... 通过 (误差: 2.34e-14)
  测试3: 单频正弦波... 通过 (误差: 3.45e-14)
  测试4: 高斯白噪声... 通过 (误差: 4.56e-13)
  测试5: IFFT往返变换... 通过 (误差: 5.67e-14)

...

========================================
所有测试通过! ✓
========================================
```

### 步骤2: 验证快速卷积

运行快速卷积验证脚本:
```matlab
run('test_fast_conv.m')
```

**预期输出**:
```
========================================
快速卷积验证测试
========================================

测试1: 长信号与短滤波器
  计算基准结果 (conv)... 完成 (0.012秒)
  计算测试结果 (fast_conv_os)... 完成 (0.003秒)
  加速比: 4.00x
  长度匹配: 10030 ✓
  最大误差: 2.34e-11
  结果验证: 通过 ✓

...

========================================
所有测试通过! ✓
========================================
```

## 运行仿真

### 基本仿真

运行完整的4QAM CMA盲均衡仿真:
```matlab
run('main_cma_simulation.m')
```

**仿真流程**:
1. ✅ 生成20000个4QAM符号
2. ✅ 通过ISI信道 [1, 0.5, 0.2]
3. ✅ 添加AWGN噪声 (SNR = 25dB)
4. ✅ CMA盲均衡(31抽头,μ=0.001)
5. ✅ 相位校正
6. ✅ 解调与性能评估

**预期输出**:

命令窗口显示:
```
========================================
4QAM通信系统CMA盲均衡仿真
========================================

配置参数:
  符号数量: 20000
  SNR: 25 dB
  信道抽头: [1.00, 0.50, 0.20]
  均衡器长度: 31
  CMA步长: 0.0010

发射端处理...
  生成 40000 个比特
  调制 20000 个4QAM符号
  符号能量: 1.0000

信道传输...
  应用ISI信道
  添加AWGN噪声 (SNR = 25 dB)

CMA均衡处理...
  初始化完成
  块大小: 512, 每块新样本: 482
  开始处理 40 个块...
    处理进度: 40/40 块 (100.0%)
  均衡完成

相位校正与解调...
  估计相位偏移: 45.23 度
  解调完成

性能评估...
  比较比特数: 36000
  比特错误数: 12
  误码率 (BER): 3.33e-04
  EVM: 8.45%

生成可视化结果...
可视化完成

========================================
仿真完成!
========================================
```

图形输出:
- 图1: 3个星座图对比
  - 左: 接收信号(严重失真)
  - 中: CMA均衡后(有相位旋转)
  - 右: 相位校正后(清晰的4QAM星座点)

### 参数影响分析

运行完整的参数影响分析实验:
```matlab
run('run_experiments.m')
```

**实验内容**:

1. **实验1: 步长μ的影响**
   - 测试: μ = [1e-4, 5e-4, 1e-3, 5e-3]
   - 输出: 4个星座图 + BER对比
   - 观察: 步长越大,收敛越快,但稳态误差越大

2. **实验2: 滤波器长度M的影响**
   - 测试: M = [11, 21, 31, 51]
   - 输出: 4个星座图 + BER对比
   - 观察: M太小无法完全补偿ISI,M足够大时性能显著改善

3. **实验3: SNR性能曲线**
   - 测试: SNR = 10:2:30 dB
   - 输出: BER vs SNR曲线(有/无均衡器对比)
   - 观察: CMA均衡器显著降低BER

**预期运行时间**: 约3-5分钟

## 理解输出结果

### 性能指标

#### BER (Bit Error Rate) - 误码率
- **含义**: 错误比特数 / 总比特数
- **目标**: < 1e-3 (可接受), < 1e-4 (良好), < 1e-5 (优秀)
- **典型值** (SNR=25dB): 3e-4 ~ 5e-4

#### EVM (Error Vector Magnitude) - 误差矢量幅度
- **含义**: 实际符号与理想符号的均方根误差(百分比)
- **目标**: < 10% (可接受), < 5% (良好)
- **典型值**: 5% ~ 10%

### 星座图解读

**接收信号星座图** (左图):
- 星座点严重分散
- 无法区分4个符号
- ISI和噪声的综合影响

**CMA均衡后星座图** (中图):
- 星座点开始聚集
- 仍存在相位旋转(CMA固有特性)
- 4个点云可见但有旋转

**相位校正后星座图** (右图):
- 清晰的4个点云
- 对齐到标准4QAM位置 [(±1±j)/√2]
- 点云大小反映EVM

## 自定义参数

### 修改仿真参数

编辑 `main_cma_simulation.m` 的第12-29行:

```matlab
%% 步骤1: 仿真参数配置

config = struct();

% ===== 可修改的参数 =====

% 1. 符号数量 (越多越准确,但运行时间越长)
config.numSymbols = 20000;  % 推荐: 10000 ~ 50000

% 2. 信噪比 (dB)
config.snr_dB = 25;         % 推荐: 15 ~ 30

% 3. 信道冲激响应 (模拟ISI)
config.channelTaps = [1, 0.5, 0.2];  % 可自定义

% 4. 均衡器长度 (建议为信道长度的2-3倍)
config.cma.filterLength = 31;  % 推荐: 21, 31, 41

% 5. CMA步长 (影响收敛速度和稳态误差)
config.cma.stepSize = 0.001;   % 推荐: 1e-4 ~ 1e-3

% 6. FFT点数 (影响计算效率)
config.fft.nfft = 512;         % 必须是2的幂: 256, 512, 1024
```

### 参数选择指南

| 参数 | 推荐值 | 影响 |
|------|--------|------|
| numSymbols | 20000 | 越大越准确,但越慢 |
| snr_dB | 20-30 | 信噪比,影响噪声水平 |
| filterLength | 信道长度×2-3 | 太小无法均衡,太大增加计算量 |
| stepSize | 5e-4 ~ 1e-3 | 大则快但不稳,小则慢但稳 |
| nfft | 512 | 2的幂,越大效率越高(到一定程度) |

### 测试不同信道

**轻微ISI**:
```matlab
config.channelTaps = [1, 0.2];
```

**中等ISI**:
```matlab
config.channelTaps = [1, 0.5, 0.2];
```

**严重ISI**:
```matlab
config.channelTaps = [1, 0.8, 0.5, 0.3];
```

**复数信道**:
```matlab
config.channelTaps = [1, 0.3*exp(1j*pi/6), 0.1*exp(-1j*pi/4)];
```

## 常见问题

### Q1: 运行时出现"输入长度必须是2的整数次幂"错误

**原因**: FFT函数要求输入长度为2的幂

**解决**:
- 检查 `config.fft.nfft` 是否为 2^n (如256, 512, 1024)
- 确保您使用的是 `core/` 目录下的新代码

### Q2: BER很高 (>1e-2) 或星座图完全混乱

**可能原因**:
1. 步长太大导致发散
2. 滤波器长度不足
3. SNR太低

**解决方法**:
```matlab
% 尝试减小步长
config.cma.stepSize = 1e-4;  % 从小开始

% 增加滤波器长度
config.cma.filterLength = 51;

% 提高SNR
config.snr_dB = 30;
```

### Q3: 仿真运行很慢

**优化方法**:
1. 减少符号数量:
   ```matlab
   config.numSymbols = 5000;  % 临时测试用
   ```

2. 增大FFT块大小:
   ```matlab
   config.fft.nfft = 1024;  % 更高效
   ```

### Q4: 星座图有旋转但未校正

**检查**:
- 相位校正代码是否正确运行
- 瞬态样本是否足够多

**调整**:
```matlab
% 在 main_cma_simulation.m 第102行附近
transient_samples = 2000;  % 增加瞬态样本数
```

### Q5: 如何保存结果?

在仿真脚本末尾添加:
```matlab
% 保存图形
saveas(gcf, 'cma_results.png');

% 保存数据
save('simulation_results.mat', 'ber', 'evm', 'equalizedSymbols_corrected');
```

### Q6: 验证测试失败

**步骤**:
1. 确认MATLAB版本 >= R2018b
2. 清除工作空间: `clear; clc;`
3. 切换到正确目录: `cd('matlab_project/core')`
4. 重新运行测试

如果仍然失败,检查:
- 是否使用了 `core/` 目录下的新代码
- 文件是否完整(没有被部分编辑)

## 下一步

### 深入学习
- 阅读 [技术规格书](../../CMA均衡器MATLAB代码生成技术规格书.md)
- 阅读 [重构报告](../../docs/MATLAB_Refactoring_Report.md)
- 研究CMA算法原理

### 进阶实验
- 尝试不同的调制方式(需修改代码)
- 实现变步长CMA
- 对比其他均衡算法(LMS, RLS)

### 硬件实现
- 查看 `vivado_project/` 目录下的Verilog实现
- 学习如何将MATLAB设计转换为硬件

## 技术支持

- **文档**: 查看项目根目录下的 README.md
- **问题**: 检查 `docs/` 目录下的相关文档
- **参考**: 技术规格书中的引用文献

---

**最后更新**: 2025-10-14  
**版本**: v2.0
